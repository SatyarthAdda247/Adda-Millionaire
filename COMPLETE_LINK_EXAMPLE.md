# Complete Link Creation Example

This document shows how to create a complete working affiliate link with an example affiliate.

## Quick Test

Run the test script to create a complete example:

```bash
cd server
node ../test-complete-link.js
```

## Manual Steps

### 1. Create Example Affiliate

Example affiliate data structure:

```json
{
  "id": "unique-id-here",
  "name": "Test Affiliate Example",
  "email": "test-affiliate@example.com",
  "phone": "+919876543210",
  "socialHandle": "@testaffiliate",
  "platform": "Instagram",
  "approvalStatus": "approved",
  "status": "active",
  "createdAt": "2025-01-XX...",
  "updatedAt": "2025-01-XX..."
}
```

### 2. Create Link via AppTrove API

**Endpoint:** `POST /api/apptrove/create-link`

**Payload:**
```json
{
  "templateId": "wBehUW",
  "linkData": {
    "name": "Test Affiliate Example - Affiliate Link",
    "campaign": "Test_Affiliate_Example_Affiliate_Influencer",
    "deepLinking": "Test_Affiliate_Example_Affiliate_Influencer",
    "status": "active"
  },
  "affiliateData": {
    "id": "affiliate-id",
    "name": "Test Affiliate Example",
    "email": "test-affiliate@example.com"
  }
}
```

**Expected Response:**
```json
{
  "success": true,
  "unilink": "https://applink.reevo.in/d/xxxxx?pid=...",
  "linkId": "link-id-here",
  "createdVia": "api-registered"
}
```

### 3. Save Link to DynamoDB

Link data structure:

```json
{
  "id": "link-id-from-apptrove",
  "userId": "affiliate-id",
  "unilink": "https://applink.reevo.in/d/xxxxx",
  "templateId": "wBehUW",
  "campaign": "Test_Affiliate_Example_Affiliate_Influencer",
  "status": "active",
  "affiliateId": "affiliate-id",
  "affiliateName": "Test Affiliate Example",
  "affiliateEmail": "test-affiliate@example.com",
  "createdVia": "api-registered",
  "createdAt": "2025-01-XX...",
  "updatedAt": "2025-01-XX..."
}
```

## Working Link Format

A complete working link looks like:

```
https://applink.reevo.in/d/testaffiliatelink?pid=d78eea61-7a27-408f-926e-90aae774c68c&cost_value=0&cost_currency=INR&lbw=1d&camp=test-affiliate&dlv=test-affiliate
```

**Components:**
- **Domain:** `applink.reevo.in` (from `APPTROVE_DOMAIN`)
- **Link ID:** `testaffiliatelink` (generated by AppTrove)
- **Parameters:**
  - `pid`: Partner ID (from template)
  - `cost_value`: Cost value (0 for free)
  - `cost_currency`: Currency (INR)
  - `lbw`: Lookback window (1d = 1 day)
  - `camp`: Campaign name (matches `campaign` in payload)
  - `dlv`: Deep linking value (matches `deepLinking` in payload)

## Verification

1. **Check AppTrove Dashboard:**
   - Link should appear in AppTrove dashboard
   - Link should be visible under the template

2. **Test Link:**
   - Open link in browser
   - Should redirect to Play Store
   - Should track clicks in AppTrove

3. **Check DynamoDB:**
   - Link should be saved in `edurise-links` table
   - Affiliate should be in `edurise-users` table

## Troubleshooting

### Link not visible in AppTrove dashboard
- Check if API call succeeded (`createdVia: "api-registered"`)
- Verify template ID is correct (`wBehUW`)
- Check AppTrove API logs for errors

### Link doesn't redirect to Play Store
- Verify template has Play Store URL configured
- Check `androidAppID` matches: `com.addaeducation.reevo`
- Verify link was created via API (not manually constructed)

### API authentication fails
- Check environment variables are set in Vercel
- Verify `APPTROVE_SECRET_ID` and `APPTROVE_SECRET_KEY` are correct
- Check S2S API Key IP whitelisting (if using S2S API)

## Example Output

```
üöÄ Starting complete link creation test...

============================================================
üìù Creating example affiliate...
   Name: Test Affiliate Example
   Email: test-affiliate-1234567890@example.com
   ID: 1234567890-abc123xyz
‚úÖ Affiliate created successfully!

üîó Creating link via AppTrove API...
   Template ID: wBehUW
   Affiliate: Test Affiliate Example
   Payload: {
     "name": "Test Affiliate Example - Affiliate Link",
     "campaign": "Test_Affiliate_Example_Affiliate_Influencer",
     "deepLinking": "Test_Affiliate_Example_Affiliate_Influencer",
     "status": "active"
   }

   Trying endpoint: https://api.apptrove.com/internal/link-template/wBehUW/link
   Status: 200
‚úÖ Link created successfully!
   URL: https://applink.reevo.in/d/testaffiliatelink
   Link ID: abc123xyz

üíæ Saving link to DynamoDB...
   Link ID: abc123xyz
   URL: https://applink.reevo.in/d/testaffiliatelink
‚úÖ Link saved to DynamoDB!

============================================================
‚úÖ COMPLETE LINK CREATION SUCCESSFUL!

üìã Summary:
   Affiliate ID: 1234567890-abc123xyz
   Affiliate Name: Test Affiliate Example
   Affiliate Email: test-affiliate-1234567890@example.com
   Link ID: abc123xyz
   Link URL: https://applink.reevo.in/d/testaffiliatelink
   Template ID: wBehUW
   Campaign: Test_Affiliate_Example_Affiliate_Influencer

üîó Working Link:
   https://applink.reevo.in/d/testaffiliatelink

üìä Test the link:
   1. Open the link in a browser
   2. It should redirect to Play Store
   3. Check AppTrove dashboard to verify tracking
============================================================
```
